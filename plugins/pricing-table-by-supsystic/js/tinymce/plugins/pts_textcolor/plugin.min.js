tinymce.PluginManager.add("pts_textcolor",function(o){function r(r){var e;return o.dom.getParents(o.selection.getStart(),function(o){var t;!e&&(t=jQuery(o).css("forecolor"==r?"color":"background-color"))&&(e=t)}),e}function e(r,e){o._ptsColorPickerBookmark&&o.selection.moveToBookmark(o._ptsColorPickerBookmark),o.formatter.apply(r,{value:e})}function t(o,r){e(o,r)}function n(o){if(o){if(o._items&&o._items.length)for(var r=0;r<o._items.length;r++){if(o._items[r]._classes&&o._items[r]._classes[0]&&"colorbutton"==o._items[r]._classes[0])return o._items[r];var e=n(o._items[r]);if(e)return e}return!1}}function l(o,e){e=e?e:r("forecolor"),o.css({"background-color":e})}var c,i,a;i=o.settings.textcolor_rows||5,c=o.settings.textcolor_cols||8,o.on("click",function(r){if(o.theme){var e=n(o.theme.panel);if(!e)return;var t=null;for(var c in e._elmCache){t=e._elmCache[c];break}l(jQuery(t).find(".ptsColorpickerInput"))}}),o.on("BeforeRenderUI",function(o){var r=n(o.target.theme.panel);r&&setTimeout(function(){var o=null;for(var e in r._elmCache){o=r._elmCache[e];break}jQuery(o).html('<div class="ptsColorpickerInputShell"><div class="ptsColorpickerInput"></div></div>'),l(jQuery(o).find(".ptsColorpickerInput"))},10)}),jQuery(function(){o.addButton("forecolor",{type:"panelbutton",tooltip:"Text color",format:"forecolor",classes:"colorbutton",panel:{role:"application",ariaRemember:!0,html:"",classes:"colorpanel",border:1,onpostrender:function(e){if(!e.control._ptsInited){e.control._ptsFirstTimeChange=!0;var n=jQuery("#"+e.control._id);n.html("<div class='wpColorPicker'></div>"),n.attr("bottom-panel","cp");var l=jQuery.extend({color:r("forecolor"),appendTo:n.find(".wpColorPicker").get(0),renderCallback:function(r,n){var l="rgba("+r.webSmart.r+","+r.webSmart.g+","+r.webSmart.b+","+r.alpha+")";e.control._ptsFirstTimeChange=!1,e.control._ptsFirstTimeChange||t("forecolor",l),o._ptsColorPickerBookmark=o.selection.getBookmark(2,!0);var c=l;jQuery("#"+e.control._parent._id+" .ptsColorpickerInput").css("background-color",c),jQuery("#"+e.control._parent._id).trigger("colorpickersliders.updateColor",c)}},g_ptsColorPickerOptions),c=new ColorPicker(l);e.control._ptsInited=!0,a=c}},onshow:function(e){o._ptsColorPickerBookmark=o.selection.getBookmark(2,!0);var t=r("forecolor");a&&(a.setColor(r("forecolor"),"rgb"),a.startRender()),jQuery("#"+e.control._parent._id).trigger("colorpickersliders.updateColor",t),jQuery("#"+e.control._id).removeClass("mce-container");var n=jQuery("#"+e.control.rootControl._id);n.hasClass("cp-hideArrow")||n.addClass("cp-hideArrow")}}})})});